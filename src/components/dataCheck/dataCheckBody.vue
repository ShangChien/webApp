<!-- eslint-disable vue/attributes-order -->
<script setup lang='ts'>
import { h, onMounted, reactive, ref, watch } from 'vue'
import type { VNodeChild } from 'vue'
import { useMessage } from 'naive-ui'
import editor from '@/components/monaco/editor.vue'
import spectrum from '@/components/dataCheck/spectrum.vue'
import fileSelector from '@/components/monaco/fileSelector.vue'
import { useDataCheckStore } from '@/components/dataCheck/dataCheckStore'

const fileIndex = ref<number>(0)
const allFiles = ref<{ name: string; contents: string }[]>([{
  name: 'test.csv', contents: `nm,T211201-41-1,T230718-13-1
650,0.03,0.031
649,0.031,0.032
648,0.031,0.031
647,0.031,0.032
646,0.03,0.032
645,0.031,0.032
644,0.031,0.031
643,0.032,0.032
642,0.031,0.031
641,0.031,0.032
640,0.031,0.031
639,0.031,0.032
638,0.031,0.032
637,0.031,0.032
636,0.031,0.033
635,0.031,0.033
634,0.032,0.032
633,0.032,0.033
632,0.032,0.033
631,0.032,0.033
630,0.032,0.032
629,0.032,0.032
628,0.033,0.033
627,0.032,0.034
626,0.032,0.033
625,0.032,0.033
624,0.032,0.033
623,0.032,0.033
622,0.032,0.033
621,0.032,0.033
620,0.033,0.034
619,0.032,0.034
618,0.033,0.033
617,0.032,0.034
616,0.034,0.034
615,0.033,0.034
614,0.033,0.034
613,0.033,0.035
612,0.033,0.034
611,0.034,0.034
610,0.033,0.035
609,0.034,0.035
608,0.034,0.034
607,0.033,0.035
606,0.034,0.035
605,0.033,0.035
604,0.034,0.035
603,0.034,0.035
602,0.034,0.035
601,0.034,0.036
600,0.034,0.035
599,0.035,0.036
598,0.035,0.036
597,0.035,0.035
596,0.035,0.036
595,0.035,0.035
594,0.035,0.036
593,0.035,0.036
592,0.035,0.036
591,0.035,0.036
590,0.036,0.036
589,0.035,0.036
588,0.036,0.037
587,0.036,0.036
586,0.036,0.037
585,0.036,0.037
584,0.035,0.037
583,0.036,0.037
582,0.036,0.037
581,0.036,0.036
580,0.036,0.037
579,0.036,0.038
578,0.036,0.037
577,0.037,0.037
576,0.037,0.038
575,0.037,0.038
574,0.037,0.037
573,0.037,0.038
572,0.037,0.037
571,0.037,0.038
570,0.037,0.038
569,0.037,0.038
568,0.037,0.038
567,0.037,0.039
566,0.038,0.037
565,0.037,0.039
564,0.038,0.038
563,0.038,0.038
562,0.038,0.039
561,0.038,0.039
560,0.038,0.038
559,0.038,0.04
558,0.038,0.039
557,0.038,0.039
556,0.038,0.039
555,0.038,0.039
554,0.039,0.04
553,0.038,0.038
552,0.039,0.039
551,0.039,0.04
550,0.039,0.04
549,0.039,0.04
548,0.04,0.041
547,0.039,0.039
546,0.04,0.04
545,0.039,0.04
544,0.039,0.041
543,0.04,0.04
542,0.039,0.04
541,0.04,0.041
540,0.04,0.041
539,0.04,0.04
538,0.041,0.041
537,0.04,0.041
536,0.04,0.041
535,0.041,0.041
534,0.041,0.041
533,0.041,0.041
532,0.041,0.041
531,0.04,0.041
530,0.041,0.041
529,0.041,0.041
528,0.041,0.041
527,0.041,0.041
526,0.041,0.041
525,0.041,0.042
524,0.041,0.041
523,0.041,0.041
522,0.041,0.042
521,0.041,0.041
520,0.042,0.042
519,0.042,0.042
518,0.042,0.041
517,0.042,0.043
516,0.042,0.042
515,0.042,0.041
514,0.042,0.043
513,0.042,0.042
512,0.042,0.042
511,0.042,0.043
510,0.043,0.042
509,0.043,0.043
508,0.042,0.043
507,0.043,0.043
506,0.043,0.043
505,0.043,0.043
504,0.043,0.043
503,0.043,0.043
502,0.043,0.043
501,0.043,0.044
500,0.043,0.043
499,0.044,0.044
498,0.044,0.043
497,0.043,0.044
496,0.043,0.044
495,0.044,0.043
494,0.043,0.044
493,0.044,0.043
492,0.044,0.044
491,0.044,0.043
490,0.044,0.044
489,0.044,0.044
488,0.044,0.045
487,0.044,0.043
486,0.044,0.044
485,0.045,0.044
484,0.044,0.044
483,0.045,0.045
482,0.045,0.045
481,0.045,0.044
480,0.045,0.045
479,0.045,0.045
478,0.045,0.044
477,0.045,0.045
476,0.045,0.045
475,0.045,0.045
474,0.045,0.046
473,0.046,0.045
472,0.045,0.045
471,0.045,0.045
470,0.045,0.045
469,0.046,0.045
468,0.046,0.045
467,0.046,0.046
466,0.045,0.045
465,0.046,0.045
464,0.046,0.046
463,0.046,0.046
462,0.046,0.045
461,0.046,0.046
460,0.046,0.046
459,0.046,0.046
458,0.046,0.045
457,0.046,0.045
456,0.046,0.046
455,0.046,0.046
454,0.046,0.045
453,0.047,0.046
452,0.047,0.045
451,0.046,0.046
450,0.046,0.045
449,0.047,0.045
448,0.047,0.046
447,0.047,0.045
446,0.047,0.046
445,0.047,0.046
444,0.047,0.045
443,0.047,0.046
442,0.047,0.045
441,0.047,0.045
440,0.047,0.046
439,0.048,0.045
438,0.046,0.046
437,0.047,0.046
436,0.047,0.046
435,0.047,0.046
434,0.047,0.046
433,0.047,0.046
432,0.046,0.047
431,0.047,0.045
430,0.047,0.047
429,0.046,0.045
428,0.047,0.045
427,0.048,0.045
426,0.047,0.045
425,0.047,0.046
424,0.047,0.045
423,0.047,0.045
422,0.049,0.046
421,0.048,0.047
420,0.048,0.047
419,0.048,0.046
418,0.048,0.046
417,0.047,0.046
416,0.048,0.046
415,0.048,0.045
414,0.048,0.046
413,0.048,0.046
412,0.048,0.045
411,0.047,0.045
410,0.049,0.045
409,0.048,0.045
408,0.048,0.044
407,0.048,0.044
406,0.049,0.045
405,0.048,0.045
404,0.05,0.045
403,0.05,0.045
402,0.052,0.045
401,0.052,0.046
400,0.053,0.046
399,0.055,0.047
398,0.057,0.047
397,0.06,0.048
396,0.064,0.05
395,0.066,0.051
394,0.071,0.052
393,0.074,0.056
392,0.08,0.059
391,0.087,0.062
390,0.094,0.067
389,0.102,0.072
388,0.112,0.079
387,0.123,0.085
386,0.133,0.093
385,0.145,0.103
384,0.159,0.113
383,0.173,0.125
382,0.187,0.137
381,0.206,0.152
380,0.222,0.168
379,0.239,0.186
378,0.26,0.202
377,0.277,0.223
376,0.296,0.241
375,0.314,0.263
374,0.334,0.282
373,0.354,0.305
372,0.373,0.326
371,0.389,0.345
370,0.408,0.369
369,0.427,0.39
368,0.443,0.41
367,0.459,0.429
366,0.473,0.446
365,0.487,0.465
364,0.5,0.48
363,0.512,0.495
362,0.524,0.511
361,0.539,0.528
360,0.549,0.54
359,0.557,0.55
358,0.564,0.561
357,0.572,0.573
356,0.579,0.581
355,0.587,0.586
354,0.588,0.596
353,0.593,0.6
352,0.596,0.607
351,0.599,0.612
350,0.602,0.614
349,0.605,0.62
348,0.609,0.625
347,0.613,0.632
346,0.615,0.637
345,0.621,0.641
344,0.618,0.645
343,0.617,0.647
342,0.61,0.645
341,0.599,0.636
340,0.587,0.629
339,0.572,0.617
338,0.56,0.606
337,0.551,0.598
336,0.539,0.59
335,0.53,0.579
334,0.519,0.571
333,0.512,0.565
332,0.5,0.556
331,0.49,0.546
330,0.48,0.537
329,0.469,0.525
328,0.455,0.514
327,0.443,0.498
326,0.427,0.486
325,0.415,0.472
324,0.402,0.456
323,0.388,0.444
322,0.376,0.431
321,0.368,0.417
320,0.358,0.407
319,0.347,0.398
318,0.342,0.389
317,0.334,0.381
316,0.329,0.375
315,0.323,0.366
314,0.321,0.361
313,0.318,0.357
312,0.318,0.355
311,0.319,0.352
310,0.322,0.35
309,0.324,0.354
308,0.331,0.357
307,0.34,0.362
306,0.35,0.37
305,0.362,0.377
304,0.375,0.385
303,0.391,0.395
302,0.408,0.406
301,0.429,0.422
300,0.453,0.44
299,0.478,0.462
298,0.499,0.478
297,0.51,0.492
296,0.516,0.504
295,0.514,0.504
294,0.506,0.503
293,0.498,0.501
292,0.492,0.498
291,0.485,0.494
290,0.476,0.489
289,0.468,0.484
288,0.461,0.476
287,0.452,0.47
286,0.443,0.465
285,0.434,0.458
284,0.425,0.448
283,0.414,0.441
282,0.404,0.433
281,0.396,0.424
280,0.388,0.418
279,0.384,0.411
278,0.383,0.408
277,0.381,0.407
276,0.384,0.41
275,0.39,0.413
274,0.397,0.418
273,0.406,0.427
272,0.419,0.436
271,0.433,0.449
270,0.45,0.466
269,0.467,0.484
268,0.489,0.502
267,0.511,0.521
266,0.533,0.545
265,0.55,0.564
264,0.574,0.585
263,0.597,0.606
262,0.617,0.627
261,0.642,0.655
260,0.669,0.68
259,0.694,0.706
258,0.721,0.736
257,0.749,0.761
256,0.769,0.788
255,0.79,0.807
254,0.81,0.823
253,0.831,0.845
252,0.846,0.858
251,0.862,0.873
250,0.878,0.887`,
}])

watch(fileIndex, (v) => { console.log(allFiles.value[v]?.name ?? '') })

const Store = useDataCheckStore()

const Tabs = reactive({
  files: () => h(editor, {
    strText: allFiles.value[fileIndex.value]?.contents ?? '',
    name: allFiles.value[fileIndex.value]?.name ?? '',
    onSync: e => updateText(e),
  }, null),
  spectrum: () => h(spectrum, {
    allFiles: allFiles.value,
    index: fileIndex.value,
  }),
  table: () => h(null),
})

const message = useMessage()
function _info(type: any | string, content: string | (() => VNodeChild)) {
  message.create(
    content,
    {
      type,
      closable: true,
      duration: 3000,
      keepAliveOnHover: true,
    },
  )
}

function updateText(newStrText: string) {
  allFiles.value[fileIndex.value].contents = newStrText
}
onMounted(() => {
})
</script>

<template>
  <div class="h-full w-full flex-auto flex flex-nowrap justify-start items-center bg-slate-1 rd-2 max-w-full p-1 box-border gap-1">
    <fileSelector
      v-model:allFiles="allFiles"
      v-model:fileIndex="fileIndex"
    />
    <div class="flex-auto h-full max-h-full relative box-border bg-white rd-1 relative flex">
      <KeepAlive>
        <component :is="Tabs[Store.currentTab]" v-if="fileIndex !== null" />
      </KeepAlive>
    </div>
  </div>
</template>

<style>
</style>
